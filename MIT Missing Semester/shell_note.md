# Shell 基础与常用命令详解


## 一、Shell 基础概念
### 1. 当前位置与用户身份
- **当前位置**：命令行中 `~` 符号代表用户的 **home 目录**（即当前所在位置）。
- **用户身份**：提示符 `$` 表示当前为 **非 root 用户**；若为 root 用户（系统管理员），提示符会变为 `#`。


### 2. 命令解析规则
Shell 以 **空格** 作为命令与参数的分割符，解析逻辑如下：
- 命令行中第一个单词是要执行的「程序」，后续单词均为程序的「参数」。
- 若参数包含空格（如文件夹名 `My Photos`），需通过以下方式处理，避免被误解析为多个参数：
  - 用单引号/双引号包裹：`'My Photos'` 或 `"My Photos"`
  - 用转义符 `\` 转义空格：`My\ Photos`


### 3. 程序搜索路径（$PATH 环境变量）
当执行非 Shell 关键字的指令时，Shell 会在 `$PATH` 变量指定的目录中搜索可执行程序，规则如下：
- `$PATH` 中的目录用 `:` 分隔，默认包含系统常用程序路径，例如：`/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin`。
- 相关实用命令：
  - `echo $PATH`：查看当前 `$PATH` 的配置内容。
  - `which 程序名`：查看指定程序的具体路径（如 `which echo` 可查看 `echo` 命令的位置）。
  - 直接指定路径执行程序：绕过 `$PATH` 搜索，例如 `/bin/echo $PATH`（直接调用 `/bin` 目录下的 `echo` 程序）。


### 4. 当前工作目录
- 使用 `pwd` 命令（print working directory）查看当前所在的目录路径。


### 5. 目录符号含义
- `.`：表示 **当前目录**（例如 `./script.sh` 表示执行当前目录下的 `script.sh` 脚本）。
- `..`：表示 **上级目录**（例如 `cd ..` 表示切换到当前目录的父目录）。


### 6. 文件权限解析（`ls -l` 输出）
执行 `ls -l 目录/文件` 可查看文件/目录的详细信息，以 `/home` 目录为例，输出格式如下：
```bash
drwxr-xr-x 1 missing users 4096 Jun 15 2019 missing
```
各字段含义（重点关注「权限部分」）：
- 第一个字符 `d`：表示该文件类型为 **目录**（若为 `-` 则表示普通文件，`l` 表示软链接）。
- 后续 9 个字符（分 3 组，每组 3 个）：分别对应 **所有者（owner）**、**用户组（group）**、**其他用户（others）** 的权限。
  - 权限符号含义：`r`（读权限）、`w`（写权限）、`x`（执行/搜索权限，目录需 `x` 权限才能进入）、`-`（无此权限）。
  - 示例 `rwxr-xr-x` 解读：所有者拥有读/写/执行权限（`rwx`），用户组和其他用户仅拥有读/执行权限（`r-x`）。
- 注意：`/bin` 等系统程序目录下的程序，通常对「其他用户」包含 `x` 权限，确保所有用户可执行基础命令。


## 二、常用 Shell 命令
### 1. `mkdir` - 创建目录（make directory）
**功能**：创建新的目录（文件夹），支持单级、多级目录创建。  
**基本语法**：
```bash
mkdir [选项] 目录名
```

#### 常用选项
| 选项 | 含义 |
|------|------|
| `-p` | 递归创建目录（父目录不存在时自动创建，例如 `mkdir -p a/b/c` 会自动创建 `a`、`a/b`、`a/b/c`） |
| `-v` | 显示创建过程（verbose 模式，创建成功后输出日志，便于排查问题） |

#### 示例
```bash
# 1. 创建单个目录
mkdir documents

# 2. 递归创建多层目录（父目录不存在时自动补全）
mkdir -p a/b/c

# 3. 一次性创建多个同级目录
mkdir pics videos music

# 4. 创建目录并显示过程（输出类似「mkdir: created directory 'work/project'」）
mkdir -v work/project
```


### 2. `cp` - 复制文件/目录（copy）
**功能**：复制文件或目录到指定位置，支持批量复制、改名复制。  
**基本语法**：
```bash
cp [选项] 源文件/目录 目标位置
```

#### 常用选项
| 选项 | 含义 |
|------|------|
| `-r`/`-R` | 递归复制目录（**复制目录时必须加此选项**，否则会报错“不是目录”） |
| `-i` | 覆盖目标文件前提示确认（interactive 模式，避免误删已有文件） |
| `-v` | 显示复制过程（输出类似「'file.txt' -> '/home/user/docs/file.txt'」） |
| `-a` | 归档模式（保留文件的权限、时间戳、软链接等属性，递归复制，常用于备份） |

#### 示例
```bash
# 1. 复制文件到目标目录（目标目录需提前存在）
cp file.txt /home/user/docs/

# 2. 复制文件并改名（目标位置指定新文件名）
cp image.jpg /home/user/pics/photo.jpg

# 3. 复制目录（必须加 -r，否则报错）
cp -r documents/ /backup/

# 4. 批量复制多个文件到同一目录
cp report.pdf notes.txt /home/user/archive/

# 5. 覆盖文件前提示确认（若目标文件已存在，会询问「是否覆盖？」）
cp -i old.txt new.txt
```


### 3. `mv` - 移动/重命名文件/目录（move）
**功能**：两种核心用途——将文件/目录移动到新位置，或对文件/目录重命名。  
**基本语法**：
```bash
mv [选项] 源文件/目录 目标位置
```

#### 常用选项
| 选项 | 含义 |
|------|------|
| `-i` | 覆盖目标文件前提示确认（避免误覆盖重要文件） |
| `-v` | 显示移动过程（输出类似「'file.txt' -> '/home/user/docs/file.txt'」） |

#### 示例
```bash
# 1. 移动文件到目标目录
mv file.txt /home/user/docs/

# 2. 重命名文件（源和目标在同一目录，本质是“移动到同一目录下的新名称”）
mv oldname.txt newname.txt

# 3. 移动文件并改名（同时完成移动和重命名）
mv data.csv /home/user/reports/2023_data.csv

# 4. 移动目录（无需额外选项，直接操作）
mv pics/ /home/user/media/

# 5. 批量移动文件（用通配符匹配所有 .txt 文件，移动到 docs 目录）
mv *.txt docs/

# 6. 覆盖前提示确认（若目标目录已存在同名文件，会询问确认）
mv -i file.txt /home/user/docs/
```


### 4. `cat` - 查看/合并文件内容（concatenate）
**功能**：核心用途包括「查看文件内容」「合并多个文件」「创建新文件」，是文本处理的基础命令。  
**基本语法**：
```bash
cat [选项] [文件...]
```

#### 常用选项
| 选项 | 含义 |
|------|------|
| `-n` | 显示行号（包括空行，每行前添加序号） |
| `-b` | 显示行号（不包括空行，仅对非空行编号） |

#### 示例
```bash
# 1. 查看单个文件内容（一次性输出全部内容）
cat filename.txt

# 2. 查看多个文件内容（按顺序拼接显示，先 file1 再 file2）
cat file1.txt file2.txt

# 3. 创建新文件并输入内容（输入命令后直接敲内容，按 Ctrl+D 保存退出）
cat > newfile.txt

# 4. 合并多个文件到新文件（将 file1 和 file2 的内容写入 combined.txt，覆盖原有内容）
cat file1.txt file2.txt > combined.txt

# 5. 向文件追加内容（内容追加到 existing.txt 末尾，不覆盖原有内容，按 Ctrl+D 结束）
cat >> existing.txt

# 6. 查看文件并显示行号（包括空行）
cat -n filename.txt

# 7. 查看文件并显示行号（排除空行）
cat -b filename.txt
```
- 注意：若文件过大，`cat` 会一次性输出所有内容导致屏幕滚动过快，建议配合 `less` 分页查看（如 `cat largefile.txt | less`）。


### 5. `grep` - 文本搜索工具（Global Regular Expression Print）
**功能**：从文本中搜索匹配「指定模式（字符串/正则表达式）」的内容，常用于日志分析、文本筛选。  
**基本语法**：
```bash
grep [选项] 模式 文件名
```

#### 常用选项
| 选项 | 含义 |
|------|------|
| `-i` | 忽略大小写（搜索时不区分字母大小写，如 `grep -i "hello"` 匹配 `Hello`/`HELLO`） |
| `-n` | 显示匹配行的行号（输出结果中包含行号，便于定位） |
| `-v` | 反向匹配（只显示不包含「模式」的行） |
| `-r`/`-R` | 递归搜索（搜索指定目录下的所有文件，包括子目录） |
| `-w` | 匹配整个单词（仅匹配完整单词，不匹配单词的一部分，如 `grep -w "cat"` 不匹配 `category`） |
| `-c` | 只显示匹配的行数（不输出具体内容，仅统计匹配行数） |
| `-l` | 只显示包含匹配内容的文件名（不输出匹配内容，仅列出文件名） |
| `-E` | 使用扩展正则表达式（支持 `|`/`()` 等特殊符号，无需转义） |

#### 示例
```bash
# 1. 在 example.txt 中搜索字符串 "hello"
grep "hello" example.txt

# 2. 忽略大小写搜索 "hello"
grep -i "hello" example.txt

# 3. 搜索 "error" 并显示行号（日志分析常用）
grep -n "error" log.txt

# 4. 递归搜索当前目录下所有文件中的 "pattern"（`.` 表示当前目录）
grep -r "pattern" .

# 5. 反向匹配：显示不包含 "exclude" 的行
grep -v "exclude" data.txt

# 6. 用正则表达式搜索以 "start" 开头的行（`^` 表示行首）
grep "^start" file.txt

# 7. 用正则表达式搜索以 "end" 结尾的行（`$` 表示行尾）
grep "end$" file.txt

# 8. 结合管道筛选命令输出（例如查看所有 python 进程）
ps aux | grep "python"
```


## 三、Shell 程序间的连接方式
### 1. 重定向（Redirect）
重定向用于改变程序的「输入流」或「输出流」，将数据从文件读取/写入文件，而非默认的“键盘输入”“屏幕输出”。  
核心重定向符号：
- `>`：将程序的「标准输出」写入文件（覆盖原有内容，若文件不存在则创建）。
- `>>`：将程序的「标准输出」追加到文件末尾（不覆盖原有内容）。
- `<`：将程序的「标准输入」从文件读取（而非从键盘输入）。

#### 示例
```bash
# 1. 将 "hello" 写入 hello.txt（覆盖原有内容）
echo hello > hello.txt

# 2. 查看 hello.txt 内容（验证写入结果）
cat hello.txt  # 输出：hello

# 3. 从 hello.txt 读取输入，再写入 hello2.txt（输入输出均重定向）
cat < hello.txt > hello2.txt

# 4. 向 hello.txt 追加内容（不覆盖原有内容）
echo world >> hello.txt
cat hello.txt  # 输出：hello \n world
```


### 2. 管道（Pipe）
管道符 `|` 的作用是「将前一个命令的标准输出，作为后一个命令的标准输入」，实现多个命令的“链式协作”。  
#### 示例
```bash
# 1. 查看当前目录下的文件，筛选包含 "txt" 的文件名（ls 输出 → grep 输入）
ls | grep "txt"

# 2. 统计当前目录下 .sh 脚本的数量（ls 输出 → grep 筛选 → wc 统计行数）
ls | grep "\.sh" | wc -l

# 3. 分页查看大文件内容（cat 输出 → less 分页）
cat largefile.txt | less
```


## 四、关键注意事项
1. **目录操作差异**：
   - `cp` 复制目录时 **必须加 `-r` 选项**，否则无法递归处理子目录，直接报错。
   - `mv` 移动目录时 **无需额外选项**，直接指定源目录和目标位置即可（本质是修改目录路径，无需复制文件）。

2. **防误操作建议**：
   - 执行 `cp`/`mv` 覆盖操作时，优先添加 `-i` 选项，避免误删/覆盖重要文件（系统会提示确认，需手动输入 `y` 才执行）。

3. **通配符使用**：
   - 批量处理文件时可使用通配符，常见通配符：
     - `*`：匹配任意长度的任意字符（如 `*.txt` 匹配所有以 `.txt` 结尾的文件）。
     - `?`：匹配单个任意字符（如 `?.txt` 匹配 `a.txt`、`1.txt`，不匹配 `ab.txt`）。
     - `[]`：匹配括号内的任意一个字符（如 `[a-z].txt` 匹配 `a.txt`、`b.txt`，不匹配 `1.txt`）。

4. **查看程序文档**：
   - 使用 `man 程序名` 查看命令的完整手册（如 `man cp`、`man grep`），手册包含所有选项说明和示例，按 `q` 可退出手册界面。